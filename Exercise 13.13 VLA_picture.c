/*
	Name: 赵子豪(ZiHao Zhao)
	Date: 2018年1月7日
*/
/*	VLA_picture.c -- use digitals to represent a picuture	*/
#include <stdio.h>
#include <string.h>			/*	strchr() prototype	*/
#include <stdlib.h>			/*	exit() prototpye	*/
#include <math.h>			/*	rand() prototype	*/
#include <ctype.h>

#define SIZE 31			/*	the max size of the file name	*/

char * s_gets(char *, int);			/*	read a string with size given	*/
int display(int rows, int cols, char (*) [cols], FILE *);			/*	display the strings to a file	*/
int copy(int rows, int cols char (*) [cols], int (*) [cols - 1]);				/*	copy a int array to a string	*/

int main(void)
{
	FILE * fpr, * fpw;
	int i, j;
	int rows, cols;
	char name[SIZE];
	char ch;

	/*	write to a file	*/
	puts("Enter a name of a file which store the digitals generated by rand() function");
	s_gets(name, SIZE);
	if ((fpw = fopen(name, "wb")) == NULL)			/*	with a comma, it is wrong	*/
	{
		fprintf(stderr, "Can't open %s as a write file.\n", name);
		exit(EXIT_FAILURE);
	}
	for (i = 0; i < ROWS * (COLS - 1); i++)
	{
		if (i % 30 == 0)
			putchar('\n');
		putc(rand() % 10, fpw);
		putc(' ', fpw);
	}
	if (fclose(fpw) != 0)
		fprintf(stderr, "Error closing file.\n");

	/*	read a file to a array	*/
	puts("Enter the rows of the digital array");
	while (scanf("%d", &rows) != 1)
		fputs("enter a integer as rows.\n", stderr);
	puts("Enter the cols of the digital array");
	while (scanf("%d", &cols) != 1)
		fputs("enter a integer as cols.\n", stderr);
	/*	declare a VLA_array	*/
	int digit[rows][cols - 1];
	if ((fpr = fopen(name, "rb")) == NULL)
	{
		fprintf(stderr, "Can't open %s as a read file.\n", name);
		exit(EXIT_FAILURE);
	}
	for (i = 0; i < rols; i++)
	{
		j = 0;
		while (j < cols - 1)
		{
			if((ch = getc(fpr)) != EOF && isdigit(ch))
				digit[i][j] = ch;
			else
				continue;
			j++;
		}
	}
	if (fclose(fpr) != 0)
		fprintf(stderr, "Error closing file.\n");

	/*	copy the digit to str	*/
	/*	declare a VLA_array	*/
	char str[rows][cols];

	copy(rows, cols, str, digit) ? fputs("Successfully copy.", stdout) : fputs("bad luck", stderr);

	/*	display the picture in a text	*/
	puts("Enter the name of file which store the picture.");
	s_gets(name, SIZE);
	if ((fpw = fopen(name, "wb")) == NULL)
	{
		fprintf(stderr, "Can't open %s as a write file.\n", name);
		exit(EXIT_FAILURE);
	}
	display(rows, cols, str, fpw) ? fputs("Successfully display.\n", stdout) : fputs("Bad luck.\n", stderr);
	if (fclose(fpw) != 0)
		fprintf(stderr, "Error closing file.\n");

	return 0;
}



/*	read a string	*/
char * s_gets(char * st, int n)
{
	char * ret_val;
	char * find;

	ret_val = fgets(st, n, stdin);
	if (ret_val)
	{
		if (find = strchr(st, '\n'))
			*find = '\0';
		else
			while (getchar() != '\n')
				continue;
	}

	return ret_val;
}



/*	copy a int array to a sring	*/
int copy(int rows, int cols, char (* str)[cols], int (* digit)[cols - 1])
{
	int flag = 0;
	int i, j, num;

	for (i = 0; i < rows; i++)
	{
		for (j = 0; j < cols - 1; j++)
		{
			switch(num = digit[i][j])
			{
				case 0 :
						str[i][j] = ')';
						break;
				case 1 :
						str[i][j] = '!';
						break;
				case 2 :
						str[i][j] = '@';
						break;
				case 3 :
						str[i][j] = '#';
						break;
				case 4 :
						str[i][j] = '$';
						break;
				case 5 :
						str[i][j] = '%';
						break;
				case 6 :
						str[i][j] = '^';
						break;
				case 7 :
						str[i][j] = '&';
						break;
				case 8 :
						str[i][j] = '*';
						break;
				case 9 :
						str[i][j] = '(';
						break;
			}
		}
		str[i][cols - 1] = '\0';
	}
	i == ROWS ? (flag = 1) : flag;

	return flag;
}



/*	display a picture which represented by strings to a file	*/
int display(int rows, int cols, char (* st) [COLS], FILE * out)
{
	int flag = 0;
	int i;

	for  (i = 0; i < rows; i++, st++)
		fputs(*st, out);
	i == rows ? (flag = 1) : flag;

	return flag;
}
